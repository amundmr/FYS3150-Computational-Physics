\documentclass[../main.tex]{subfiles}

\begin{document}
\section{Theory}\label{theory}
\subsection{The Earth-Sun system}
%oppgave 5a og b)
Before starting coding with object orientation, we will look at the problem by simply using Eulers forward method and the Verlet method.
In two dimensions we will have the following for the Earth-Sun system \\

The gravitational force  $\text{F}$

\begin{equation}
  F_G= \frac{GM_0M_E}{r^2} 
\end{equation}

where $M_E = 6\times 10^{24}\text{Kg}$,  $ M_0 = 2\times 10^{30}\text{Kg}$, and  $r = 1.5\times 10^{11}\text{m}$\\ The force acting on Earth is given by Newtons 2. law, here given in x- and y- direction

$$ \frac{d^2x}{dt^2} = \frac{F_x}{M_E}, \quad \frac{d^2y}{dt^2} = \frac{F_y}{M_E}$$

By using the following equalities $x = r \cos(\theta)$,  $y = r\sin(\theta)$ and $r = \sqrt{x^2 +y^2}$ we obtain

\begin{equation}
  F_x = - \frac{GM_0M_E}{r^2} \cos(\theta) =- \frac{GM_0M_E}{r^3}x
\end{equation}
\begin{equation}
  F_y = - \frac{GM_0M_E}{r^2}\sin(\theta) =- \frac{GM_0M_E}{r^3}y,
\end{equation}

This gives the following first order  coupled differential equations:
\begin{equation}
  \frac{dv_x}{dt} = - \frac{GM_0}{r^3}x
\end{equation}
\begin{equation}
  \frac{dx}{dt} = v_x
\end{equation}
\begin{equation}
  \frac{dv_y}{dt} = - \frac{GM_0}{r^3}y
\end{equation}
\begin{equation}
  \frac{dy}{dt} = v_y,
\end{equation}

In order to simplify we will use Astronomical units AU defined by $r$, which is the avarage distance between Earth and the sun.

Introducing astronomical units: 1 $\text{AU = r} = 1.5 \times 10^{11}$

\begin{equation}
  \frac{M_ev^2}{r} = F = \frac{GM_0M_E}{r^2}
\end{equation}

Since $GM_=  v^2r$ and the velocity of Earth, assuming it moves in circular motion: $$v = 2\pi \text{r/years}= 2\pi \text{AU/years}$$

Then we have the following relationship

$$GM_0 = v^2r = 4\pi^2 \frac{(\text{AU})^2}{\text{years}^2}$$

Bulding code- discretized equations:
$$v_{x,i+1} = v_{x,i} - h \frac{4\pi^2}{r_i^3}x_i$$
$$x_{i+1} = x_{i} + hv_{x,i}$$
$$v_{y,i+1} = v_{xy,i} - h \frac{4\pi^2}{r_i^3}y_i$$
$$y_{i+1} = y_{i} + hv_{y,i}$$

\subsection{The Verlet method}
Another numerical method to be used to evalute the motion of planets in our solarsystem is the Verlet method. This is a method pretty easy to implment as well as it gives stable results. When calculating molecular dynamics, this method is one of the first choises to implement.

If we again look at Newtons second law in the form of a second order differential equation in one dimension.

\begin{equation}
 m \frac{d^2x}{dt^2} = F(x,t)
\end{equation}

In coupled diffenretial equations one obtain

$$\frac{dx}{dt} = v(x,t)$$    and     $$\frac{dv}{dt} = F(x,t)/m = a(x,t)$$

Using a Taylor expansion:

\begin{equation}
 x(t,h) = x(t) + hc^{(1)}(t) + \frac{h^2}{2}x^{(2)}(t) + O(h^3).
\end{equation}

From Newtons second law we allready have obtained the second derivative, $x^{(2)}(t) = a(x,t)$.

Using Taylor for $x(t-h)$ and the discretized expressions $x(t_i,\pm h) = x_{i \pm 1}$ and $x_i = x(t_i)$ we obtain

\begin{equation}
  x_{i+1} = 2x_i - x_{i-1} + h^2 x_i^{(2)} + O(h^4)
\end{equation}

Corresponding velocity Taylor expansion is

\begin{equation}
  v_{i+1} = v_i + hv_{(1)} + \frac{h^2}{2} v_i^{(2)} + O(h^3)
\end{equation}

With Newtons second law:

\begin{equation}
  v_i^{(1)} = \frac{d^2x}{dt^2} = \frac{F(x_i, t_i)}{m},
\end{equation}

Adding the expansion of the derivative of the velocity

\begin{equation}
  v_{i+1} = v_i + \frac{h}{2}\left(v_{i+1}^{(1)} + v_i^{(1)}\right) + O(h^3)
\end{equation}

Since our error goes as $O(h^3)$ we only use the terms up to the second derivative of the velocity.

\begin{equation}
  hv_i^{(2)}\approx v_{i+1}^{(1)} - v_i^{(1)}
\end{equation}

Rewriting the Taylor expansions for the velocity:

\begin{equation}
  x_{i+1} = x_i + hv_i + \frac{h^2}{2} v_i^{(1)} + + O(h^3)
\end{equation}

and

\begin{equation}
  v_{i+1} = v_i + \frac{h}{2} \left(v_{i+1}^{(1)} + v_i^{(1)}\right) + O(h^3)
\end{equation}

%oppgave 5c)
\subsection{Testing of the algorithm}
Before inserting all the planets in the solar system, we would like to thoroughly test the simple Sun-Earth case. This is done by finding initial values for a perfectly circular orbit, and then test stability with different stepsizes and check for conservation of energy. We will also compare the performance of Eulers forward method to the Verlet method.
\subsubsection{Initial values}
When using astronomical units the radius between the Sun and Earth is quite easily set to $1AU$. The mass of the Sun is also set to $1$, and the Earth mass is relative to this mass. For the orbit to be circular we set the centripetal force equal and opposite to the gravitational force. For finding the velocity, the equations are formulated as the following:
\begin{align}
  F_g &= \frac{\gamma M_\odot M_E}{r^2}\nonumber \\
  F_c &= \frac{M_E v^2}{r}\nonumber \\
  \frac{\gamma M_\odot M_E}{r^2} &= \frac{M_E v^2}{r}\nonumber \\
  v &= \sqrt{\frac{\gamma M_\odot}{r}}\nonumber \\
  \intertext{Where $\gamma$ is the gravitational constant commonly set to $4\pi^2$ for solar system computations. Since $M_\odot$ and $r$ is $1$, we get:}
  v &= 2\pi \frac{AU}{yr}
\end{align}
Thus our initial value for the velocity of Earth should be $2\pi$. This is achieved setting x-position to $0$, x-velocity to $2\pi$, y-position to $1$ and y-velocity to $0$.

\subsubsection{Stability with varying timestep}
Changing the timestep $\Delta t$ is crucial for finding a good balance between calculation speed and accuracy. We simulated over a period of a thousand years. The timesteps simulated was $\Delta t = \{0.01, 0.02, 0.05, 0.1\}$ years. The results are shown in section \ref{sec:results-test-timestep}.
\subsubsection{Energy and angular momentum conservation}
As we have a circular orbit, we would expect the potential and kinetic energy to be conserved since the velocity is the same, and the distance from the sun should also be the same. These energies should be conserved since the only forces acting on the system is conservative forces, namely the gravitational force.

$$E_{tot} = E_k + E_p = \frac{1}{2} M_E v^2 + M_E \gamma r$$

Conservation of angular momentum is true if the system is not acted upon by a torque. Since the only force acting on the system is the gravitational pull of the sun, the angular momentum must be conserved. This can be shown by the following:

\begin{align*}
  L &= I \omega \\
  I &= r^2m, \hspace{5mm} \omega = \frac{v}{r} \\
  L &= r^2m \frac{v}{r} \\
  L &= rmv
\end{align*}
Thus the angular momentum is conserved as long as the orbit velocity is constant, which it is if the kinetic energy is conserved.

\subsection{Escape velocity}
The escape velocity is the minimum veocity needed by an object to be projected to overcome the pull from the gravitational force in order to escape the gravitanonal field and the orbit.

$$v_esc = \sqrt{\frac{2GM}{R}}$$

where G is the unversal gravitatonal constant, $6.673\times 10^{-11} m^2kg^{-2}$, M is the mass of the sun and R is the radius of the sun.

We will also look at what will happen if the gravitational force is change to the following

$$F_G = \frac{GM_0M_E}{r^{\beta}}$$

with $\beta \in [2,3]$, e.g. changing the exponetial from 2 towards 3 and study the difference.

\subsection{The three-body problem}
In order to find out how much the planet with the greatest mass, Jupiter, alters the motion of the Earth. Without Jupiter the motion will remain unchanged with time and  will be stable.

This is done by simply adding the magnitude of the force between Earth and Jupiter,

\begin{equation}
  F_{Earth-Jupiter} = \frac{GM_{Jupiter}}{r^2_{Earth-Jupiter}}
\end{equation}

Where $M_Jupiter$ is the mass of Jupiter, and $M_Earth$ is the mass of Eart. $r$ is the distance between the two planets, and G is the gravitational constant.

The problem is calculated by modifying the first order differential equations to accomodate the motion of Earth and Jupiter by taking into account the distance between them, x,y and z with the Verlet algorithm. We will also study the effect of altering the masss of Jupiter by a factor of 10 and 100.

\subsection{All planets}
 Finally we will assamble all of our previus systems, Earth, Jupiter and the Sun in motion, using the Verlet solver. Instead of setting the center of mass at the position of the Sun, it will be set at the origin. The initial velocity will be such that the total momentum of the system is zero so the center of mass is fixed. Thereafter we will include all the other planets in our system as well as moons if there is time. The initial velocities and positons are taken from NASA's webpage \href{http://ssd.jpl.nasa.gov/horizons.cgi#top}{(link)}

\subsection{The perihelion precession of Mercury }
When a planet is the closest the sun, called, perihelion, it is a good measurment/test of general relativity theory by calculating the theoretical value and compare it with observations. For Mercury, after substracting all the classical effects, the observed time is 43 seconds per century.

...
We will here study the orbit of Mercury around the sund with a slightly adjusted gravita force where the general relativistic correction is added to the Newtonian gravitational force

\begin{equation}
  F_G = \frac{GM_{Sum}M_{Mercury}}{r^2} \left[ 1+\frac {3l^2}{(rc)^2} \right]
\end{equation}

 with the distance r to the Sun and with angular momentum $l = \vec r \times \vec v$ of Mercery per unit mass and c is the speed of light. The perihelion angle $\phi_p$ is given by
$$\tan \phi_p = \frac{y_p}{x_p}$$

where $y_p$ and $x_p$ is the position of Mercury at perihelion. The speed of Mercery at perihelion is 12.44 AU/yr and the distance to the Sun is 0.3075 AU

\end{document}
